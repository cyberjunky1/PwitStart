<?php

class MwSmarty {

	private static $instance = null;

	private function __construct() {
		
	}
	
	public static function getInstance() {
		if(is_null(self::$instance)) {
			self::$instance = new Smarty();
			$path = MwPrefs::getInstance()->getAppPath();
			
			$template_dir = MwMisc::concat_dirs($path,"mwView");
			self::$instance->setTemplateDir($template_dir);
			
			$compile_dir = MwMisc::concat_dirs($path,"_compil");
			self::$instance->setCompileDir($compile_dir);
			
			$config_dir = MwMisc::concat_dirs($path,"mwLang");
			self::$instance->setConfigDir($config_dir);
			
			$cache_dir = MwMisc::concat_dirs($path,"mwView");
			self::$instance->setCacheDir($cache_dir);
			
			$smartyPlugins = "../rsrc/smartyPlugins";
			self::$instance->addPluginsDir($smartyPlugins);
			
			self::$instance->caching = false;
			
			return self::$instance;			
		}
		return self::$instance;
	}

	/**
	 * Chargement des fichiers de configuration
	 * @param String $section section a charger
	 */
	public static function mWLoadSecLangFile($section){
		if(isset($_SESSION['lang'])){
			$lang = $_SESSION['lang'];
		}
		else {
			$lang = MwPrefs::getInstance()->getDefaultLang();
		}
		$inst = self::getInstance();
		
		switch ($lang){
			case 'en':
				$inst->configLoad("en.lang",$section);
				break;
			case 'dt':
				$inst->configLoad("dt.lang",$section);
				break;
			case 'fr':
				$inst->configLoad("fr.lang",$section);
				break;
			default:
				$inst->configLoad("en.lang",$section);
				break;
		}
	}
}
