<?php
class MwConnexion {
	
	protected $isLogged = false;
	protected $userId   = "";
		
	private function __construct (){
		if (isset($_SESSION['isLogged'])) {
			$this->userId   = $_SESSION['userId'];
			$this->isLogged = true;
		}
		else{
			$this->userId   = "";
			$this->isLogged = false;
		}
	}
	
	public static function logIn ($login, $pass){
		$isOk = MwUser::checkPassword($login, $pass, $userId);
		if ($isOk === true){	
			$_SESSION['isLogged'] = true;
			$_SESSION['userId']   = $userId;
			return true;
		}
		return false;				
	}
	
	public function logOut(){
		$_SESSION['isloged']=false;	
		$_SESSION['userId']="";
		$this->isLogged = false;
		$this->userId = "";		
		session_destroy();
	}

	public static function checkConnexion (){
		$connnexion = self::getInstance();		
		if ($connnexion->isLogged === false) {
			header("Location: "."../index.php");
			exit;
		}
		else{
			return true;
		}		
	}
	
	public static function getInstance (){
		static $connexion;
		if (isset($connexion) === false) {
			$connexion = new MwConnexion();
		}
		return $connexion;
	}
	
	public function isLogged(){
		return $this->isLogged;
	}
	
	public function getUserId(){
		return $this->userId;
	}
}
