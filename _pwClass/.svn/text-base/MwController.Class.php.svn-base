<?php

abstract class MwController extends MwSuper{

	protected $checkConnexion = true;

	/**
	 * Tableau des Sections du fichier de configuration
	 * @var Array()
	 */
	protected $confSec = array();
	protected $subViews = array();

	/**
	 * Construct
	 */
	public function __construct(){
		$this->actionInit();
	}

	/**
	 * Exécuté à chque appel du controleur
	 */
	public function actionInit(){

	}

	public function actionBeforDisplay(){

	}

	public function actionAfterDisplay(){

	}

	/**
	 * @param Arg $get
	 */
	public function actionIndex($get = array()){
		if ($this->checkConnexion == true){
			MwConnexion::checkConnexion();
		}
		$getTab = array();
		$smarty = MwSmarty::getInstance();
		$smarty->assign('title',MwPrefs::getInstance()->getProject());
		$smarty->assign('version',MwPrefs::getInstance()->getVersion());
		$action = $get[0];
		for($i=2;$i<count($get);$i++){
			$smarty->assign('p'.($i-1),$get[$i]);
			$getTab[]=$get[$i];
		}
		if(count($this->confSec)==0){
			$this->confSec[0]=$action;
		}
		$_SESSION['MwGet']=$getTab;
		$this->actionBeforDisplay();
		foreach ($this->subViews as $value) {
			//Ajouter la section des langues
			$this->confSec[] = $value;
			//execution du controlleur actionBeforDisplay
			$subController = $value."Controller";
			$subObj= new $subController();
			$subObj->actionBeforDisplay();
		}

		$fname = $action.".tpl";
		try {
			foreach ($this->confSec as $key=> $val){
				MwSmarty::mWLoadSecLangFile($val);
			}
			$smarty->display($fname);
		}
		catch (Exception $e){
			MwDebug::debug("Smarty Error",$e->getMessage());
		}

		$this->actionAfterDisplay();
		foreach ($this->subViews as $value) {
			//Ajouter la section des langues
			$this->confSec[] = $value;
			//execution du controlleur actionBeforDisplay
			$subController = $value."Controller";
			$subObj= new $subController();
			$subObj->actionAfterDisplay();
		}
	}
}
